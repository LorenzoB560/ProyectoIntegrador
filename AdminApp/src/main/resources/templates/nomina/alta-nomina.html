<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Alta de Nómina</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!--CSS para los fragmentos    -->
    <link rel="stylesheet" th:href="@{/css/estilos-generales.css}">
</head>
<body class="bg-light">
<div th:replace="fragmentos/header :: header"></div>
<div th:replace="fragmentos/nav :: nav"></div>

<div class="container mt-5">
    <h1 class="mb-4">Alta de Nómina</h1>

    <form id="formulario" class="card shadow p-4 bg-white rounded">
        <!-- Empleado -->
        <div class="mb-3">
            <label for="idEmpleado" class="form-label">Empleado:</label>
            <select id="idEmpleado" name="idEmpleado" class="form-select">
                <option th:each="emp : ${listaEmpleados}"
                        th:value="${emp.id}"
                        th:text="${emp.nombre} + ' ' + ${emp.apellido}">
                </option>
            </select>
        </div>

        <!-- Mes y Año -->
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="mes" class="form-label">Mes de nómina</label>
                <select id="mes" name="mes" class="form-select">
                    <option th:each="mes : ${meses}" th:value="${mes}" th:text="${mes}"></option>
                </select>
            </div>
            <div class="col-md-6 mb-3">
                <label for="anio" class="form-label">Año de nómina</label>
                <select id="anio" name="anio" class="form-select">
                    <option th:each="anio : ${anios}" th:value="${anio}" th:text="${anio}"></option>
                </select>
            </div>
        </div>

        <!-- Conceptos -->
        <h4 class="mt-4">Conceptos</h4>
        <div id="conceptos-container" class="mb-3">
            <!-- Aquí se insertan dinámicamente los conceptos -->
        </div>

        <div class="mb-4">
            <button type="button" class="btn btn-outline-primary" onclick="agregarConcepto()">+ Añadir Concepto</button>
        </div>

        <!-- Total -->
        <div class="mb-3">
            <h5>Total líquido: <span id="totalLiquido">0.00</span> €</h5>
            <input type="hidden" name="totalLiquido" id="totalLiquidoHidden">
        </div>

        <!-- Template oculto para los conceptos -->
        <select id="concepto-template" class="d-none">
            <option th:each="c : ${listaConceptos}" th:value="${c.id}" th:data-tipo="${c.tipo}"
                    th:text="${c.nombre + ' (' + c.tipo + ')'}"></option>
        </select>

        <!-- Botón enviar -->
        <div class="d-grid">
            <button type="submit" class="btn btn-success">Guardar Nómina</button>
        </div>
    </form>
</div>

<!-- Scripts -->
<script src="/js/calcularTotal.js"></script>
<script src="/js/agregarConcepto.js"></script>
<script src="/js/enviarNomina.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<div th:replace="fragmentos/footer :: footer"></div>
</body>
</html>
